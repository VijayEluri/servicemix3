<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">
<beans>

  <!-- Transaction log -->
  <bean id="transactionLog" class="org.apache.geronimo.transaction.log.UnrecoverableLog" />
  <!--
  <bean id="transactionLog" class="org.apache.geronimo.transaction.log.HOWLLog">
    <contructor-arg value="org.objectweb.howl.log.BlockLogBuffer"/> 
    <contructor-arg value="32"/> 
    <construcor-arg value="true"/>
    <construcor-arg value="50"/> 
    <construcor-arg value="var/txlog"/> 
    <construcor-arg value="log"/> 
    <construcor-arg value="howl"/>
    <construcor-arg value="-1"/>
    <construcor-arg value="0"/> 
    <construcor-arg value="2"/> 
    <construcor-arg value="4"/> 
    <construcor-arg value="-1"/> 
    <construcor-arg> 
      <bean class="org.apache.geronimo.transaction.manager.XidFactoryImpl"/>
    </constructor-arg>
    <construcor-arg> 
      <bean class="org.apache.geronimo.system.serverinfo.ServerInfo">
          <constructor-arg value="var/geronimo"/>
      </bean>
    </constructor-arg>
  </bean>
  -->
  
  <!-- Internal transaction manager -->
  <bean id="extendedTransactionManager" class="org.jencks.factory.TransactionManagerFactoryBean">
    <property name="transactionLog" ref="transactionLog" />
    <property name="defaultTransactionTimeoutSeconds" value="600"/>
  </bean>
  
  <!-- Transaction context manager -->
  <bean id="transactionContextManager" class="org.jencks.factory.TransactionContextManagerFactoryBean">
    <property name="transactionManager" ref="extendedTransactionManager"/>
  </bean>
  
  <!-- Public transaction manager -->
  <bean id="transactionManager" class="org.jencks.factory.GeronimoTransactionManagerFactoryBean">
    <property name="transactionContextManager" ref="transactionContextManager"/>
  </bean>
  
  <!-- Work manager -->
  <bean id="workManager" class="org.jencks.factory.WorkManagerFactoryBean">
    <property name="threadPoolSize" value="30"/>
    <property name="transactionContextManager" ref="transactionContextManager"/>
  </bean>
  
  <!-- Bootstrap context for JCA -->
  <bean id="bootstrapContext" class="org.jencks.factory.BootstrapContextFactoryBean">
    <property name="workManager" ref="workManager"/>
  </bean>
  
  <!-- Connection manager for JCA -->
  <bean id="connectionTracker" class="org.apache.geronimo.connector.outbound.connectiontracking.ConnectionTrackingCoordinator"/>
  <bean id="poolingSupport" class="org.jencks.factory.SinglePoolFactoryBean">
    <property name="maxSize" value="16"/>
    <property name="minSize" value="1"/>
    <property name="blockingTimeoutMilliseconds" value="60"/>
    <property name="idleTimeoutMinutes" value="60"/>
    <property name="matchOne" value="true"/>
    <property name="matchAll" value="true"/>
    <property name="selectOneAssumeMatch" value="true"/>
  </bean>
  <bean id="transactionSupport" class="org.jencks.factory.XATransactionFactoryBean">
    <property name="useTransactionCaching" value="true"/>
    <property name="useThreadCaching" value="true"/>
  </bean>
  <bean id="connectionManager" class="org.jencks.factory.ConnectionManagerFactoryBean">
    <property name="containerManagedSecurity" value="false"/>
    <property name="transactionContextManager" ref="transactionContextManager"/>
    <property name="poolingSupport" ref="poolingSupport"/>
    <property name="transactionSupport" ref="transactionSupport"/>
    <property name="connectionTracker" ref="connectionTracker"/>
  </bean>
  
</beans>
